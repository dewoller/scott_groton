---
title:           Initial Analysis
author:          Dennis Wollersheim
date:            15.04.2020
linkcolor:       cyan
citecolor:       grey
output:
  pdf_document:
    highlight:   zenburn
---

\tableofcontents

```{r include=FALSE}

source('lib/functions.R')

min_mandndi = 80
read.spss('data/Groton Maze_v2.sav') %>%
{ . } -> spss_orig

attr(spss_orig, 'variable.labels') %>%
  data.frame( stringsAsFactors=FALSE) %>%
  setNames('label') %>%
  tibble::rownames_to_column(var = "variable")  %>%
  as_tibble() %>%
  mutate(variable=str_to_lower(variable)) %>%
  { . } -> df_names

df_names %>%
  filter( str_detect( variable, '_t5$', )) %>%
  mutate( variable = str_replace( variable, '_t5','')) %>%
  mutate( variable = str_replace( variable, '^cog','cog_')) %>%
  mutate( label = str_replace( label, ' - TIME 5','')) %>%
  { . } -> df_one_names

spss_orig %>%
  as_tibble() %>%
  janitor::clean_names() %>%
  filter( !is.na(participant_no)) %>%
  filter( mandndi > min_mandndi) %>%
  { . } -> df_in
  df_in

df_in %>%
  select(ends_with('t2')) %>%
  rename_all( str_replace, '_t2','') %>%
  names() %>%
  { . } -> t1_names

t1_names %>%
  str_replace('$', '_t1') %>%
  { . } -> t1_names_new

  df_in

df_in %>%
  rename_all( str_replace, '_t1','') %>%
  rename_at( vars( t1_names), ~t1_names_new) %>%
  { . } -> df_in

#t1_names %>% clipr::write_clip()

prefix='cog_gml'

df_in %>%
  select(cohort, id, starts_with( prefix )) %>%
  pivot_longer( cols=starts_with( prefix ),
                names_to=c('type','period') ,
                names_pattern=paste0(prefix, "(...)_t(.)"),
                values_to='value',
                values_drop_na=TRUE ) %>%
  mutate( id = str_trim(id)) %>%
  mutate( period = as.numeric(period)) %>%
  { . } -> df_in_long

```

```{r graph, results='asis'}

graph_type='dur'


  df_in_long %>%
    distinct( type ) %>%
    mutate( variable = paste0(prefix, type) ) %>%
    inner_join( df_one_names ) %>%
    by_row(make_one_introductory_graph) %>%
  { . } -> dev_null



```







